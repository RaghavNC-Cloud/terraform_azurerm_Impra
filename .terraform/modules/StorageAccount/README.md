# Azure Storage Account

The module allows you to create Azure Storage Accounts and its dependent resources. For more info on Azure Storage Account, click [here](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account)

## Usage
```
module "storage" {
  source                            = "app.terraform.io/<TFC organization name>/storage-account/azurerm"
  version                           = "x.x.x"
  storage_accounts                  = var.storage_accounts
  storage_shares                    = var.storage_shares
  storage_data_lake_gen2_filesystem = var.storage_data_lake_gen2_filesystem
  tags                              = var.tags
}
```
<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) | =3.51 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | =3.51 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [azurerm_storage_account.this](https://registry.terraform.io/providers/hashicorp/azurerm/3.51/docs/resources/storage_account) | resource |
| [azurerm_storage_container.this](https://registry.terraform.io/providers/hashicorp/azurerm/3.51/docs/resources/storage_container) | resource |
| [azurerm_storage_data_lake_gen2_filesystem.this](https://registry.terraform.io/providers/hashicorp/azurerm/3.51/docs/resources/storage_data_lake_gen2_filesystem) | resource |
| [azurerm_storage_share.this](https://registry.terraform.io/providers/hashicorp/azurerm/3.51/docs/resources/storage_share) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_azurerm_client_config"></a> [azurerm\_client\_config](#input\_azurerm\_client\_config) | AzureRM provider configuration | `any` | `null` | no |
| <a name="input_data_lake_group_id"></a> [data\_lake\_group\_id](#input\_data\_lake\_group\_id) | Specifies the Object ID of the Azure Active Directory Group to make the owning group of the root path (i.e. /). | `string` | `null` | no |
| <a name="input_data_lake_id"></a> [data\_lake\_id](#input\_data\_lake\_id) | Specifies the Object ID of the Azure Active Directory User or Group that the entry relates to. Only valid for user or group entries. | `string` | `null` | no |
| <a name="input_data_lake_owner_id"></a> [data\_lake\_owner\_id](#input\_data\_lake\_owner\_id) | Specifies the Object ID of the Azure Active Directory User to make the owning user of the root path (i.e. /). | `string` | `null` | no |
| <a name="input_storage_accounts"></a> [storage\_accounts](#input\_storage\_accounts) | Parameters used to create `Azure Storage Account`<br><br>`name` = (`Required` The name of the storage account.)<br><br>`resource_group_name` = (`Required` The name of the resource group in which to create the storage account.)<br><br>`location` = (`Optional` The Azure region where the storage account will be created. Defaults to `uksouth`)<br><br>`account_kind` = (`Optional` The kind of storage account. Defaults to `StorageV2`)<br><br>`account_tier` = (`Required` The tier of the storage account.)<br><br>`account_replication_type` = (`Required` The replication type of the storage account.)<br><br>`access_tier` = (`Optional` The access tier of the storage account. Defaults to `Hot`)<br><br>`public_network_access_enabled` = (`Optional` Specifies whether public network access is allowed for the storage account. Defaults to `true`)<br><br>`enable_https_traffic_only` = (`Optional` Specifies whether HTTPS traffic is required for the storage account. Defaults to `true`)<br><br>`is_hns_enabled` = (`Optional` Specifies whether Hierarchical Namespace (HNS) is enabled for the storage account.)<br><br>`allow_nested_items_to_be_public` = (`Optional` Specifies whether nested items can be set as public in the storage account. Defaults to `false`)<br><br>`nfsv3_enabled` = (`Optional` Specifies whether NFSv3 protocol is enabled for the storage account. Defaults to `false`)<br><br>`large_file_share_enabled` = (`Optional` Specifies whether large file shares are enabled for the storage account. Defaults to `true`)<br><br>`min_tls_version` = (`Optional` The minimum TLS version supported by the storage account. Defaults to `TLS1_2`)<br><br>`cross_tenant_replication_enabled`  = (`Optional` Should cross Tenant replication be enabled? Defaults to `true`.)<br><br>`shared_access_key_enabled` = (`Optional` Indicates whether the storage account permits requests to be authorized with the account access key via Shared Key. Defaults to `true`. )<br><br>`default_to_oauth_authentication` = (`Optional` Default to Azure Active Directory authorization in the Azure portal when accessing the Storage Account. The default value is `false`)<br><br>`queue_encryption_key_type` = (`Optional` The encryption type of the queue service. Default value is `Service`.)<br><br>`table_encryption_key_type` = (`Optional` The encryption type of the table service. Default value is `Service`.)<br><br>`infrastructure_encryption_enabled` = (`Optional` Is infrastructure encryption enabled? Defaults to `false`.)<br><br>`allowed_copy_scope` = (`Optional` Restrict copy to and from Storage Accounts within an AAD tenant or with Private Links to the same VNet.)<br><br>`sftp_enabled` = (`Optional` Enable SFTP for the storage account.)<br><br>`blob_properties` = (`Optional` A blob\_properties block as defined below.)<br><br>`versioning_enabled` = (`Optional` Specifies whether versioning is enabled for the Blob service. Defaults to `true`)<br><br>`change_feed_enabled` = (`Optional` Specifies whether change feed is enabled for the Blob service. Defaults to `true`)<br><br>`change_feed_retention_in_days` = (`Optional` The duration of change feed events retention in days.)<br><br>`default_service_version` = (`Optional` The API Version which should be used by default for requests to the Data Plane API if an incoming request doesn't specify an API Version.)<br><br>`last_access_time_enabled` = (`Optional` Is the last access time based tracking enabled? Default to `false`.)<br><br>`delete_retention_policy` = (`Optional` A delete\_retention\_policy block as defined below.)<br><br>`days` = (`Optional` Specifies the number of days that the blob should be retained, between 1 and 365 days. Defaults to `7`)<br><br>`container_delete_retention_policy` = (`Optional` A container\_delete\_retention\_policy block as defined below.)<br><br>`days` = (`Optional` Specifies the number of days that the container should be retained, between 1 and 365 days. Defaults to `7`.)<br><br>`restore_policy` = (`Optional` A restore\_policy block as defined below.)<br><br>`days` = (`Required` Specifies the number of days that the blob can be restored, between 1 and 365 days. This must be less than the days specified for delete\_retention\_policy.)<br><br>`cors_rule` = (`Optional` A cors\_rule block as defined below.)<br><br>`allowed_headers` = (`Required` A list of headers that are allowed to be a part of the cross-origin request.)<br><br>`allowed_methods` = (`Required` A list of HTTP methods that are allowed to be executed by the origin. Valid options are DELETE, GET, HEAD, MERGE, POST, OPTIONS, PUT or PATCH.)<br><br>`allowed_origins` = (`Required` A list of origin domains that will be allowed by CORS.)<br><br>`exposed_headers` = (`Required` A list of response headers that are exposed to CORS clients.)<br><br>`max_age_in_seconds` = (`Required` The number of seconds the client should cache a preflight response.)<br><br>`queue_properties` = (`Optional` A queue\_properties block as defined below.)<br><br>`logging` = (`Optional` A logging block as defined below.)<br><br>`delete` = (`Required` Indicates whether all delete requests should be logged.)<br><br>`read` = (`Required` Indicates whether all read requests should be logged.)<br><br>`version` = (`Required` The version of storage analytics to configure.)<br><br>`write` = (`Required` Indicates whether all write requests should be logged.)<br><br>`retention_policy_days` = (`Optional` Specifies the number of days that logs will be retained.)<br><br>`minute_metrics` = (`Optional` A minute\_metrics block as defined below.)<br><br>`enabled` = (`Required` Indicates whether minute metrics are enabled for the Queue service.)<br><br>`version` = (`Required` The version of storage analytics to configure.)<br><br>`include_apis` = (`Optional` Indicates whether metrics should generate summary statistics for called API operations.)<br><br>`retention_policy_days` = (`Optional` Specifies the number of days that logs will be retained.)<br><br>`hour_metrics` = (`Optional` A hour\_metrics block as defined below.)<br><br>`enabled` = (`Required` Indicates whether hour metrics are enabled for the Queue service.)<br><br>`version` = (`Required` The version of storage analytics to configure.)<br><br>`include_apis` = (`Optional` Indicates whether metrics should generate summary statistics for called API operations.)<br><br>`retention_policy_days` = (`Optional` Specifies the number of days that logs will be retained.)<br><br>`share_properties` = (`Optional` A share\_properties block as defined below.)<br><br>`retention_policy` = (`Optional` A retention\_policy block as defined below.)<br><br>`days` = (`Optional` Specifies the number of days that the azurerm\_storage\_share should be retained, between 1 and 365 days. Defaults to `7`.)<br><br>`smb` = (`Optional` A smb block as defined below.)<br><br>`versions` = (`Optional` A set of SMB protocol versions. Possible values are SMB2.1, SMB3.0, and SMB3.1.1.)<br><br>`authentication_types` = (`Optional` A set of SMB authentication methods. Possible values are NTLMv2, and Kerberos.)<br><br>`kerberos_ticket_encryption_type` = (`Optional` A set of Kerberos ticket encryption. Possible values are RC4-HMAC, and AES-256.)<br><br>`channel_encryption_type` = (`Optional` A set of SMB channel encryption. Possible values are AES-128-CCM, AES-128-GCM, and AES-256-GCM.)<br><br>`multichannel_enabled` = (`Optional` Indicates whether multichannel is enabled. Defaults to `false`. This is only supported on Premium storage accounts.)<br><br>`static_website` = (`Optional` A static\_website block as defined below.)<br><br>`index_document` = (`Optional` The webpage that Azure Storage serves for requests to the root of a website or any subfolder. For example, index.html. The value is case-sensitive.)<br><br>`error_404_document` = (`Optional` The absolute path to a custom webpage that should be used when a request is made which does not correspond to an existing file.)<br><br>`custom_domain` = (`Optional` A custom\_domain block as documented below.)<br><br>`name` = (`Required` The Custom Domain Name to use for the Storage Account, which will be validated by Azure.)<br><br>`use_subdomain` = (`Optional` Should the Custom Domain Name be validated by using indirect CNAME validation?)<br><br>`immutability_policy` = (`Optional` An immutability\_policy block as defined below.)<br><br>`allow_protected_append_writes` = (`Required` When enabled, new blocks can be written to an append blob while maintaining immutability protection and compliance.)<br><br>`state` = (`Required` Defines the mode of the policy.)<br><br>`period_since_creation_in_days` = (`Required` The immutability period for the blobs in the container since the policy creation, in days.)<br><br>`network_rules` = (`Optional` A network\_rules block as documented below.)<br><br>`default_action` = (`Optional` The default action when no rules match traffic. Defaults to `Deny`)<br><br>`bypass` = (`Optional` Specifies whether traffic is bypassed for Logging/Metrics/AzureServices. Defaults to `Logging`, `Metrics`, `AzureServices`)<br><br>`ip_rules` = (`Optional` The list of IP rules for the storage account. Defaults to `155.198.30.0/23`, `146.179.32.0/21`, `20.77.153.220`, `20.77.153.167`, `20.77.153.187`, `20.77.153.237`, `51.132.159.227`, `20.56.147.101`)<br><br>`custom_ip_rules` = (`Optional` The list of custom IP rules for the storage account.)<br><br>`identity` = (`Optional` An identity block as defined below.)<br><br>`type` = (`Required` Specifies the type of Managed Service Identity that should be configured on this Storage Account.)<br><br>`routing` = (`Optional` A routing block as defined below.)<br><br>`choice` = (`Optional` Specifies the kind of network routing opted by the user. Possible values are InternetRouting and MicrosoftRouting. Defaults to `MicrosoftRouting`.)<br><br>`publish_microsoft_endpoints` = (`Optional` Should Microsoft routing storage endpoints be published? Defaults to `false`.)<br><br>`publish_internet_endpoints` = (`Optional` Specifies whether to publish Internet endpoints.) | <pre>map(object({<br>    name                              = string<br>    resource_group_name               = string<br>    location                          = optional(string, "uksouth")<br>    account_kind                      = optional(string)<br>    account_tier                      = string<br>    account_replication_type          = string<br>    access_tier                       = optional(string)<br>    public_network_access_enabled     = optional(bool)<br>    enable_https_traffic_only         = optional(bool, true)<br>    is_hns_enabled                    = optional(bool)<br>    allow_nested_items_to_be_public   = optional(bool, false)<br>    nfsv3_enabled                     = optional(bool)<br>    large_file_share_enabled          = optional(bool, true)<br>    min_tls_version                   = optional(string, "TLS1_2")<br>    cross_tenant_replication_enabled  = optional(bool)<br>    shared_access_key_enabled         = optional(bool)<br>    default_to_oauth_authentication   = optional(bool)<br>    queue_encryption_key_type         = optional(string)<br>    table_encryption_key_type         = optional(string)<br>    infrastructure_encryption_enabled = optional(bool)<br>    allowed_copy_scope                = optional(string)<br>    sftp_enabled                      = optional(bool)<br><br>    blob_properties = optional(object({<br>      versioning_enabled            = optional(bool)<br>      change_feed_enabled           = optional(bool)<br>      change_feed_retention_in_days = optional(number)<br>      default_service_version       = optional(string)<br>      last_access_time_enabled      = optional(bool)<br><br>      delete_retention_policy = optional(object({<br>        days = optional(number)<br>      }))<br><br>      container_delete_retention_policy = optional(object({<br>        days = optional(number)<br>      }))<br><br>      restore_policy = optional(object({<br>        days = optional(number)<br>      }))<br><br>      cors_rule = optional(object({<br>        allowed_headers    = string<br>        allowed_methods    = string<br>        allowed_origins    = string<br>        exposed_headers    = string<br>        max_age_in_seconds = number<br>      }))<br>    }))<br><br>    queue_properties = optional(object({<br>      minute_metrics = optional(object({<br>        enabled               = bool<br>        version               = string<br>        include_apis          = optional(bool)<br>        retention_policy_days = optional(number)<br>      }))<br><br>      cors_rule = optional(object({<br>        allowed_headers    = string<br>        allowed_methods    = string<br>        allowed_origins    = string<br>        exposed_headers    = string<br>        max_age_in_seconds = number<br>      }))<br><br>      logging = optional(object({<br>        delete                = bool<br>        read                  = bool<br>        version               = string<br>        write                 = bool<br>        retention_policy_days = optional(number)<br>      }))<br><br>      hour_metrics = optional(object({<br>        enabled               = bool<br>        version               = string<br>        include_apis          = optional(bool)<br>        retention_policy_days = optional(number)<br>      }))<br>    }))<br><br>    share_properties = optional(object({<br>      cors_rule = optional(object({<br>        allowed_headers    = string<br>        allowed_methods    = string<br>        allowed_origins    = string<br>        exposed_headers    = string<br>        max_age_in_seconds = number<br>      }))<br><br>      retention_policy = optional(object({<br>        days = optional(number)<br>      }))<br><br>      smb = optional(object({<br>        versions                        = optional(string)<br>        authentication_types            = optional(string)<br>        kerberos_ticket_encryption_type = optional(string)<br>        channel_encryption_type         = optional(string)<br>        multichannel_enabled            = optional(bool)<br>      }))<br>    }))<br><br>    static_website = optional(object({<br>      index_document     = optional(string)<br>      error_404_document = optional(string)<br>    }))<br><br>    custom_domain = optional(object({<br>      name          = string<br>      use_subdomain = optional(bool)<br>    }))<br><br>    immutability_policy = optional(object({<br>      allow_protected_append_writes = bool<br>      state                         = string<br>      period_since_creation_in_days = number<br>    }))<br><br>    network_rules = optional(object({<br>      default_action             = optional(string, "Deny")<br>      bypass                     = optional(list(string), ["Logging", "Metrics", "AzureServices"])<br>      ip_rules                   = optional(list(string), ["20.77.153.220", "20.77.153.167", "20.77.153.187", "20.77.153.237", "51.132.159.227", "20.56.147.101"])<br>      custom_ip_rules            = optional(list(string), [])<br>      virtual_network_subnet_ids = optional(list(string))<br>      private_link_access        = optional(list(map(string)), [])<br>    }), {})<br><br>    identity = optional(object({<br>      type = string<br>    }))<br><br>    routing = optional(object({<br>      choice                      = optional(string)<br>      publish_microsoft_endpoints = optional(bool)<br>      publish_internet_endpoints  = optional(bool)<br>    }))<br>  }))</pre> | `{}` | no |
| <a name="input_storage_containers"></a> [storage\_containers](#input\_storage\_containers) | Parameters used to create `Azure Storage Containers`<br><br>`name` = (`Required` The name of the Azure Storage Containers. )<br><br>`storage_account_name` = (`Required` The name of the storage account in which the container needs to be created.)<br><br>`container_access_type` = (`Required` The Access Level configured for this Container. Possible values are `blob`, `container` or `private`.) | <pre>map(object({<br>    name                  = string<br>    storage_account_name  = string<br>    container_access_type = string<br>  }))</pre> | `null` | no |
| <a name="input_storage_data_lake_gen2_filesystem"></a> [storage\_data\_lake\_gen2\_filesystem](#input\_storage\_data\_lake\_gen2\_filesystem) | Parameters used to create `Azure Data Lake Gen2 Filesystems`<br><br>`name` = (`Required` The name of the Azure Data Lake Gen2 Filesystems.)<br><br>`storage_account_name` = (`Required` The storage account name in which the Gen2 filesystem needs to be created.)<br><br>`resource_group_name` = (`Required` The storage account resource group name.)<br><br>`properties` = (`Optional` A mapping of Key to Base64-Encoded Values which should be assigned to this Data Lake Gen2 File System.)<br><br>`ace` = (`Optional` One or more ace blocks as defined below to specify the entries for the ACL for the path.)<br><br>`scope` = (`Optional` Specifies whether the ACE represents an access entry or a default entry. Default value is access.)<br><br>`type` = (`Required` Specifies the type of entry. Can be user, group, mask or other.)<br><br>`permissions` = (`Required` Specifies the permissions for the entry in rwx form. For example, rwx gives full permissions but r-- only gives read permissions.) | <pre>map(object({<br>    name                 = string<br>    storage_account_name = string<br>    resource_group_name  = string<br>    properties           = optional(map(string))<br>    ace = optional(object({<br>      scope       = optional(string)<br>      type        = string<br>      permissions = string<br>    }))<br>  }))</pre> | `null` | no |
| <a name="input_storage_shares"></a> [storage\_shares](#input\_storage\_shares) | Parameters used to create `Azure file shares`<br><br>`name` = (`Required` The name of the Azure file share.)<br><br>`access_tier` = (`Optional` The access tier of the File Share. Possible values are Hot, Cool and TransactionOptimized, Premium.)<br><br>`enabled_protocol` = (`Optional` The protocol used for the share. Possible values are SMB and NFS.)<br><br>`storage_account_name` = (`Required` The storage account name in which the file share needs to be created.)<br><br>`quota` = (`Required` The quota of the Azure file share.)<br><br>`acl` = (`Optional` One or more acl blocks as defined below.)<br><br>`id` = (`Required` The ID which should be used for this Shared Identifier.)<br><br>`access_policy` = (`Optional` An access\_policy block as defined below.)<br><br>`permissions` = (`Required` The permissions which should be associated with this Shared Identifier. Possible value is combination of r (read), w (write), d (delete), and l (list).)<br><br>`start` = (`Optional` The time at which this Access Policy should be valid from, in ISO8601 format.)<br><br>`expiry` = (`Optional` The time at which this Access Policy should be valid until, in ISO8601 format.) | <pre>map(object({<br>    name                 = string<br>    access_tier          = optional(string)<br>    enabled_protocol     = optional(string)<br>    storage_account_name = string<br>    quota                = number<br>    acl = optional(object({<br>      id = string<br>      access_policy = optional(object({<br>        permissions = string<br>        start       = optional(string)<br>        expiry      = optional(string)<br>      }))<br>    }))<br>  }))</pre> | `null` | no |
| <a name="input_tags"></a> [tags](#input\_tags) | A mapping of tags to assign to the resource. | `map(string)` | n/a | yes |
| <a name="input_user_assigned_identity_ids"></a> [user\_assigned\_identity\_ids](#input\_user\_assigned\_identity\_ids) | Specifies a list of User Assigned Managed Identity IDs to be assigned to MSSQL server. | `list(string)` | `null` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_identity_principal_id"></a> [identity\_principal\_id](#output\_identity\_principal\_id) | The principal ID(s) associated with the identity of the storage account. |
| <a name="output_storage_account_id"></a> [storage\_account\_id](#output\_storage\_account\_id) | The ID of the Azure Storage Account. |
| <a name="output_storage_account_identity"></a> [storage\_account\_identity](#output\_storage\_account\_identity) | The identity associated with the Storage Account. |
| <a name="output_storage_account_location"></a> [storage\_account\_location](#output\_storage\_account\_location) | The Azure region where the Storage Account is located. |
| <a name="output_storage_account_name"></a> [storage\_account\_name](#output\_storage\_account\_name) | The name of the Azure Storage Account. |
| <a name="output_storage_account_primary_access_key"></a> [storage\_account\_primary\_access\_key](#output\_storage\_account\_primary\_access\_key) | The primary access key of the Storage Account. |
| <a name="output_storage_account_primary_blob_connection_string"></a> [storage\_account\_primary\_blob\_connection\_string](#output\_storage\_account\_primary\_blob\_connection\_string) | The connection string for accessing the primary blob service of the Storage Account. |
| <a name="output_storage_account_primary_connection_string"></a> [storage\_account\_primary\_connection\_string](#output\_storage\_account\_primary\_connection\_string) | The connection string for accessing the primary service of the Storage Account. |
| <a name="output_storage_account_resource_group_name"></a> [storage\_account\_resource\_group\_name](#output\_storage\_account\_resource\_group\_name) | The name of the resource group containing the Storage Account. |
| <a name="output_storage_account_secondary_access_key"></a> [storage\_account\_secondary\_access\_key](#output\_storage\_account\_secondary\_access\_key) | The secondary access key of the Storage Account. |
| <a name="output_storage_account_secondary_blob_connection_string"></a> [storage\_account\_secondary\_blob\_connection\_string](#output\_storage\_account\_secondary\_blob\_connection\_string) | The connection string for accessing the secondary blob service of the Storage Account. |
| <a name="output_storage_account_secondary_connection_string"></a> [storage\_account\_secondary\_connection\_string](#output\_storage\_account\_secondary\_connection\_string) | The connection string for accessing the secondary service of the Storage Account. |
| <a name="output_storage_container_id"></a> [storage\_container\_id](#output\_storage\_container\_id) | The ID of the Azure Storage Container. |
| <a name="output_storage_container_name"></a> [storage\_container\_name](#output\_storage\_container\_name) | The name of the Azure Storage Container. |
| <a name="output_storage_data_lake_gen2_filesystem_id"></a> [storage\_data\_lake\_gen2\_filesystem\_id](#output\_storage\_data\_lake\_gen2\_filesystem\_id) | The ID of the Azure Storage Data Lake Gen2 Filesystem. |
| <a name="output_storage_data_lake_gen2_filesystem_name"></a> [storage\_data\_lake\_gen2\_filesystem\_name](#output\_storage\_data\_lake\_gen2\_filesystem\_name) | The name of the Azure Storage Data Lake Gen2 Filesystem. |
| <a name="output_storage_data_lake_gen2_filesystem_storage_account_id"></a> [storage\_data\_lake\_gen2\_filesystem\_storage\_account\_id](#output\_storage\_data\_lake\_gen2\_filesystem\_storage\_account\_id) | The ID of the Azure Storage Account associated with the Data Lake Gen2 Filesystem. |
| <a name="output_storage_share_id"></a> [storage\_share\_id](#output\_storage\_share\_id) | The ID of the Azure Storage Share. |
| <a name="output_storage_share_name"></a> [storage\_share\_name](#output\_storage\_share\_name) | The name of the Azure Storage Share. |
| <a name="output_storage_share_storage_account_name"></a> [storage\_share\_storage\_account\_name](#output\_storage\_share\_storage\_account\_name) | The name of the Azure Storage Account associated with the Storage Share. |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->