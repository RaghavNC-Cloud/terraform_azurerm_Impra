Azure SQL Server
================

The module allows you to create Azure SQL Servers, SQL FW rules and Azure SQL Database. For more info...

* [Azure MSSQL Server](https://registry.terraform.io/providers/hashicorp/azurerm/3.51.0/docs/resources/mssql_server)
* [Azure MSSQL Database](https://registry.terraform.io/providers/hashicorp/azurerm/3.51.0/docs/resources/mssql_database)
* [Azure MSSQL Firewall Rule](https://registry.terraform.io/providers/hashicorp/azurerm/3.51.0/docs/resources/mssql_firewall_rule)

Usage
```
module "mssql" {
  source                 = "app.terraform.io/<TFC Organization Name>/mssql/azurerm"
  version                = "x.x.x"
  mssql_servers          = var.mssql_servers
  mssql_databases        = var.mssql_databases
  sql_fw_rule            = var.sql_fw_rule
  tags                   = var.tags
}
```
<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) | =3.51 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | =3.51 |
| <a name="provider_random"></a> [random](#provider\_random) | n/a |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [azurerm_mssql_database.this](https://registry.terraform.io/providers/hashicorp/azurerm/3.51/docs/resources/mssql_database) | resource |
| [azurerm_mssql_firewall_rule.azure_services](https://registry.terraform.io/providers/hashicorp/azurerm/3.51/docs/resources/mssql_firewall_rule) | resource |
| [azurerm_mssql_firewall_rule.this](https://registry.terraform.io/providers/hashicorp/azurerm/3.51/docs/resources/mssql_firewall_rule) | resource |
| [azurerm_mssql_server.this](https://registry.terraform.io/providers/hashicorp/azurerm/3.51/docs/resources/mssql_server) | resource |
| [random_password.this](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/password) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_azurerm_client_config"></a> [azurerm\_client\_config](#input\_azurerm\_client\_config) | AzureRM provider configuration | `any` | n/a | yes |
| <a name="input_enable_azure_services"></a> [enable\_azure\_services](#input\_enable\_azure\_services) | Allow access to Azure services | `bool` | `true` | no |
| <a name="input_mssql_databases"></a> [mssql\_databases](#input\_mssql\_databases) | Parameters used to create `Azure SQL Database`<br><br>`name` = (`Required` The name of the SQL Database.)<br><br>`sql_server_resource_group_name` = (`Required` The name of the resource group containing the SQL Server.)<br><br>`sql_server_name` = (`Required` The name of the SQL Server.)<br><br>`collation` = (`Optional` The collation of the SQL Database. Defaults to `SQL_Latin1_General_CP1_CI_AS`)<br><br>`max_size_gb` = (`Optional` The maximum size of the SQL Database in gigabytes.)<br><br>`sku_name` = (`Optional` The SKU (pricing tier) of the SQL Database.)<br><br>`storage_account_type` = (`Optional` The storage account type of the SQL Database. Defaults to "Local")<br><br>`auto_pause_delay_in_minutes` = (`Optional` Time in minutes after which database is automatically paused. A value of -1 means that automatic pause is disabled. This property is only settable for General Purpose Serverless databases.)<br><br>`geo_backup_enabled` = (`Optional` A boolean that specifies if the Geo Backup Policy is enabled. Defaults to `true`)<br><br>`maintenance_configuration_name` = (`Optional` The name of the Public Maintenance Configuration window to apply to the database.)<br><br>`ledger_enabled` = (`Optional` A boolean that specifies if this is a ledger database. Defaults to `false`)<br><br>`license_type` = (`Optional` Specifies the license type applied to this database. Possible values are LicenseIncluded and BasePrice.)<br><br>`min_capacity` = (`Optional` Minimal capacity that database will always have allocated, if not paused. This property is only settable for General Purpose Serverless databases.)<br><br>`transparent_data_encryption_enabled` = (`Optional` If set to true, Transparent Data Encryption will be enabled on the database. Defaults to `true`)<br><br>`zone_redundant` = (`Optional` Whether or not this database is zone redundant, which means the replicas of this database will be spread across multiple availability zones. This property is only settable for Premium and Business Critical databases.)<br><br>`create_mode` = (`Optional` The create mode of the database. Possible values are Copy, Default, OnlineSecondary, PointInTimeRestore, Recovery, Restore, RestoreExternalBackup, RestoreExternalBackupSecondary, RestoreLongTermRetentionBackup and Secondary. Mutually exclusive with import. Changing this forces a new resource to be created.)<br><br>`restore_point_in_time` = (`Optional` Specifies the point in time (ISO8601 format) of the source database that will be restored to create the new database. This property is only settable for create\_mode= PointInTimeRestore databases.)<br><br>`read_replica_count` = (`Optional` The number of readonly secondary replicas associated with the database to which readonly application intent connections may be routed. This property is only settable for Hyperscale edition databases.)<br><br>`read_scale` = (`Optional` If enabled, connections that have application intent set to readonly in their connection string may be routed to a readonly secondary replica. This property is only settable for Premium and Business Critical databases.)<br><br>`sample_name` = (`Optional` Specifies the name of the sample schema to apply when creating this database.)<br><br>`short_term_retention_policy` = (`Optional` The short-term retention policy for the SQL Database.)<br><br>`retention_days` = (`Optional` The number of days to retain backups. Defaults to `30`)<br><br>`backup_interval_in_hours` = (`Optional` The backup interval in hours. Defaults to `24`)<br><br>`long_term_retention_policy` = (`Optional` The long-term retention policy for the SQL Database.)<br><br>`weekly_retention` = (`Optional` The number of weeks to retain backups.)<br><br>`monthly_retention` = (`Optional` The number of months to retain backups.)<br><br>`yearly_retention` = (`Optional` The number of years to retain backups.)<br><br>`week_of_year` = (`Optional` The week of the year for backup retention.)<br><br>`threat_detection_policy`  = (`Optional` Threat detection policy configuration. The threat\_detection\_policy block supports fields documented below.)<br><br>`state` = (`Optional` The State of the Policy. Possible values are Enabled, Disabled or New.)<br><br>`disabled_alerts` = (`Optional` Specifies a list of alerts which should be disabled. Possible values include Access\_Anomaly, Sql\_Injection and Sql\_Injection\_Vulnerability.)<br><br>`email_account_admins` = (`Optional` Should the account administrators be emailed when this alert is triggered? Possible values are Disabled and Enabled.)<br><br>`email_addresses` = (`Optional` A list of email addresses which alerts should be sent to.)<br><br>`retention_days` = (`Optional` Specifies the number of days to keep in the Threat Detection audit logs. Defaults to `30`)<br><br>`import` = (`Optional` A Database Import block as documented below. Mutually exclusive with create\_mode.)<br><br>`storage_key_type` = (`Required` Specifies the type of access key for the storage account. Valid values are StorageAccessKey or SharedAccessKey.)<br><br>`authentication_type` = (`Required` Specifies the type of authentication used to access the server. Valid values are SQL or ADPassword.) | <pre>map(object({<br>    name                                = string<br>    sql_server_resource_group_name      = string<br>    sql_server_name                     = string<br>    collation                           = optional(string, "SQL_Latin1_General_CP1_CI_AS")<br>    max_size_gb                         = optional(number)<br>    sku_name                            = optional(string)<br>    storage_account_type                = optional(string, "Local")<br>    auto_pause_delay_in_minutes         = optional(number)<br>    geo_backup_enabled                  = optional(bool)<br>    maintenance_configuration_name      = optional(string)<br>    ledger_enabled                      = optional(bool)<br>    license_type                        = optional(string)<br>    min_capacity                        = optional(number)<br>    transparent_data_encryption_enabled = optional(bool)<br>    zone_redundant                      = optional(string)<br>    create_mode                         = optional(string)<br>    restore_point_in_time               = optional(string)<br>    read_replica_count                  = optional(number)<br>    read_scale                          = optional(bool)<br>    sample_name                         = optional(string)<br><br>    short_term_retention_policy = optional(object({<br>      retention_days           = optional(number, 30)<br>      backup_interval_in_hours = optional(string, 24)<br>    }))<br><br>    long_term_retention_policy = optional(object({<br>      weekly_retention  = optional(number)<br>      monthly_retention = optional(number)<br>      yearly_retention  = optional(number)<br>      week_of_year      = optional(number)<br>    }))<br><br>    threat_detection_policy = optional(object({<br>      state                = optional(string)<br>      disabled_alerts      = optional(string)<br>      email_account_admins = optional(string)<br>      email_addresses      = optional(list(string))<br>      retention_days       = optional(number, 30)<br>      keyvault_name        = optional(string)<br>      secret_name          = optional(string)<br>      storage_account_name = optional(string)<br>    }))<br>  }))</pre> | `null` | no |
| <a name="input_mssql_servers"></a> [mssql\_servers](#input\_mssql\_servers) | Parameters used to create `Azure SQL Server`<br><br>`name` = (`Required` The name of the SQL Server.)<br><br>`resource_group_name` = (`Required` The name of the resource group in which to create the SQL Server.)<br><br>`location` = (`Optional` The Azure region where the SQL Server will be created., Defaults to `uksouth`)<br><br>`version` = (`Required` The version of the SQL Server.)<br><br>`connection_policy` = (`Optional` The connection policy for the SQL Server.)<br><br>`outbound_network_restriction_enabled` = (`Optional` Specifies whether outbound network access is restricted for the SQL Server.)<br><br>`public_network_access_enabled` = (`Optional` Specifies whether public network access is allowed for the SQL Server.)<br><br>`minimum_tls_version` = (`Optional` The minimum TLS version supported by the SQL Server.)<br><br>`administrator_login` = (`Required` Specifies the name of the SQL administrator.)<br><br>`identity` = (`Optional` The managed identity for the SQL Server.)<br><br>`type` = (`Required` The type of managed identity.)<br><br>`identity_ids` = (`Optional` The list of identity IDs associated with the SQL Server.)<br><br>`azuread_administrator` = (`Required` The Azure AD administrator settings for the SQL Server.)<br><br>`login_username` = (`Required` The login username for the Azure AD administrator.)<br><br>`azuread_authentication_only` = (`Optional` Specifies whether Azure AD authentication is the only authentication method allowed.) | <pre>map(object({<br>    name                                 = string<br>    resource_group_name                  = string<br>    location                             = optional(string, "uksouth")<br>    version                              = string<br>    connection_policy                    = optional(string)<br>    outbound_network_restriction_enabled = optional(bool)<br>    public_network_access_enabled        = optional(bool)<br>    minimum_tls_version                  = optional(string, "1.2")<br>    administrator_login                  = optional(string)<br><br>    identity = optional(object({<br>      type = string<br>    }))<br><br>    azuread_administrator = object({<br>      login_username              = string<br>      object_id                   = string<br>      azuread_authentication_only = optional(bool, true)<br>    })<br>  }))</pre> | `null` | no |
| <a name="input_server_id"></a> [server\_id](#input\_server\_id) | Azure MSSQL Server ID | `string` | `null` | no |
| <a name="input_sql_fw_rule"></a> [sql\_fw\_rule](#input\_sql\_fw\_rule) | `name` - (`Required` The name of the firewall rule. Changing this forces a new resource to be created.)<br><br>`sql_server_resource_group_name` = (`Required` The name of the resource group containing the SQL Server.)<br><br>`sql_server_name` = (`Required` The name of the SQL Server.)<br><br>`start_ip_address` - (`Required` The starting IP address to allow through the firewall for this rule.)<br><br>`end_ip_address` - (`Required` The ending IP address to allow through the firewall for this rule.) | `list(map(string))` | `[]` | no |
| <a name="input_storage_account_access_key"></a> [storage\_account\_access\_key](#input\_storage\_account\_access\_key) | Specifies the identifier key of the Threat Detection audit storage account. Required if state is Enabled. | `string` | `null` | no |
| <a name="input_tags"></a> [tags](#input\_tags) | A mapping of tags to assign to the resource. | `map(string)` | n/a | yes |
| <a name="input_user_assigned_identity_ids"></a> [user\_assigned\_identity\_ids](#input\_user\_assigned\_identity\_ids) | Specifies a list of User Assigned Managed Identity IDs to be assigned to MSSQL server. | `list(string)` | `null` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_sql_admin_password"></a> [sql\_admin\_password](#output\_sql\_admin\_password) | SQL Admin password |
| <a name="output_sql_database_creation_source_database_id"></a> [sql\_database\_creation\_source\_database\_id](#output\_sql\_database\_creation\_source\_database\_id) | The ID(s) of the source database(s) used for creation of the Azure SQL Database(s). |
| <a name="output_sql_database_id"></a> [sql\_database\_id](#output\_sql\_database\_id) | The unique identifier(s) of the Azure SQL Database(s). |
| <a name="output_sql_database_name"></a> [sql\_database\_name](#output\_sql\_database\_name) | The name(s) of the Azure SQL Database(s). |
| <a name="output_sql_database_recover_database_id"></a> [sql\_database\_recover\_database\_id](#output\_sql\_database\_recover\_database\_id) | The ID(s) of the recoverable database(s) for the Azure SQL Database(s). |
| <a name="output_sql_database_restore_dropped_database_id"></a> [sql\_database\_restore\_dropped\_database\_id](#output\_sql\_database\_restore\_dropped\_database\_id) | The ID(s) of the restore-dropped database(s) for the Azure SQL Database(s). |
| <a name="output_sql_database_server_id"></a> [sql\_database\_server\_id](#output\_sql\_database\_server\_id) | The ID(s) of the Azure SQL Server associated with the SQL Database(s). |
| <a name="output_sql_server_administrator_login"></a> [sql\_server\_administrator\_login](#output\_sql\_server\_administrator\_login) | The administrator login(s) for the SQL Server(s). |
| <a name="output_sql_server_administrator_login_password"></a> [sql\_server\_administrator\_login\_password](#output\_sql\_server\_administrator\_login\_password) | The administrator login password(s) for the SQL Server(s). |
| <a name="output_sql_server_azuread_administrator"></a> [sql\_server\_azuread\_administrator](#output\_sql\_server\_azuread\_administrator) | The Azure AD administrator(s) for the SQL Server(s). |
| <a name="output_sql_server_fully_qualified_domain_name"></a> [sql\_server\_fully\_qualified\_domain\_name](#output\_sql\_server\_fully\_qualified\_domain\_name) | The fully qualified domain name(s) for the SQL Server(s). |
| <a name="output_sql_server_id"></a> [sql\_server\_id](#output\_sql\_server\_id) | The unique identifier(s) of the Azure SQL Server(s). |
| <a name="output_sql_server_identity"></a> [sql\_server\_identity](#output\_sql\_server\_identity) | The identity configuration for the SQL Server(s). |
| <a name="output_sql_server_identity_principal_id"></a> [sql\_server\_identity\_principal\_id](#output\_sql\_server\_identity\_principal\_id) | The principal ID(s) associated with the identity of the SQL Server(s). |
| <a name="output_sql_server_name"></a> [sql\_server\_name](#output\_sql\_server\_name) | The name(s) of the Azure SQL Server(s). |
| <a name="output_sql_server_primary_user_assigned_identity_id"></a> [sql\_server\_primary\_user\_assigned\_identity\_id](#output\_sql\_server\_primary\_user\_assigned\_identity\_id) | The ID(s) of the primary user assigned identity(ies) for the SQL Server(s). |
| <a name="output_sql_server_resource_group_name"></a> [sql\_server\_resource\_group\_name](#output\_sql\_server\_resource\_group\_name) | The name of the Azure resource group in which the SQL Server(s) is located. |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->